pipeline {
  agent any
  environment {
    DOCKER_COMPOSE_VERSION = '1.29.2'
  }
  stages {
    stage('Install Dependencies') {
        agent {
            docker {
                image 'node:16-alpine'
            }
        }
        steps {
                dir('stor') {
                sh 'npm install'
            }
        }
    }
    stage('Run Jest Tests') {
        agent {
            docker {
                image 'node:16-alpine'
            }
        }
        steps {
            dir('stor')
            sh 'npm run test'
        }
    }
    post {
    always {
      sh 'docker images -q | xargs docker rmi -f || true'
    }
  }
}



// pipeline {
//     agent any
//     stages {
//         stage('Checkout') {
//             steps {
//                 git branch: 'main', url: 'https://github.com/BS-PMC-2023/BS-PMC-2023-Team25.git'
//             }
//         }
//         stage('Build') {
//             steps {
//                 sh 'npm install'
//                 sh 'npm run build'
//             }
//         }
//         stage('Test') {
//             steps {
//                 sh 'npm test'
//             }
//         }
//         stage('Deploy') {
//             steps {
//                 sh 'npm run deploy'
//             }
//         }
//     }
// }

// pipeline {
//     agent any 
//     stages {
//         stage('Stage 1') {
//             steps {
//                 echo 'Hello world!' 
//             }
//         }
//     }
// }
